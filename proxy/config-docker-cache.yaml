# Discobot Proxy Configuration - Docker Registry Caching
#
# This configuration enables caching for Docker registry pulls,
# dramatically speeding up repeated pulls of the same images.

proxy:
  port: 17080
  api_port: 17081

# TLS certificate directory
tls:
  cert_dir: ./certs

# Response caching for Docker registries
cache:
  enabled: true
  dir: ./cache
  max_size: 21474836480  # 20GB in bytes

  # Content-aware mode: detects immutable Docker/OCI blobs by sha256 digest in the
  # URL path and Docker/OCI Accept/Content-Type headers. Works for any registry or
  # CDN (ghcr.io, docker.io, ECR, ACR, GCR, …) without per-host URL patterns.
  # Response bodies are always verified against the URL sha256 digest before caching.
  content_aware: true

  # Explicit URL patterns (regex) are checked alongside content_aware — a request
  # is cached if either matches. Use this for CDN backends whose requests don't
  # carry standard OCI Accept headers.
  patterns:
    # Cloudflare R2 Docker registry storage (hash embedded as a path component, no OCI headers)
    - "^/registry-v2/docker/registry/v2/blobs/sha256/"

# Optional: Allowlist specific registries
# allowlist:
#   enabled: true
#   domains:
#     - "*.docker.io"
#     - "registry-1.docker.io"
#     - "ghcr.io"
#     - "*.gcr.io"
#     - "*.azurecr.io"

# Optional: Inject headers for authenticated registries
# headers:
#   "registry.example.com":
#     set:
#       "Authorization": "Bearer YOUR_TOKEN_HERE"

logging:
  level: info
  format: text
  file: ""  # Empty = stdout
